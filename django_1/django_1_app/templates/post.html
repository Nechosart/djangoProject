{% extends "base.html" %}
{% block content %}

{% if user %}
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
    {% csrf_token %}
{% endif %}

<centerSide>
    <link rel="preload" as="image" href="/static/like.png">
    <link rel="preload" as="image" href="/static/liked.png">

    <post id="post">
        <a href="/user/{{p.user.id}}" class="user">{{p.user.username}}</a><br>
        <info>{{p.name}}</info>
        <info>{{p.description}}</info>
        <img src="/static/like{% if p.liked %}d{% endif %}.png" class="like" id="{{p.id}}">
        <p style="display: inline-block; margin: 0px" id="{{p.id}}s">{{p.likes.count}}</p>

        <script>
            var like = document.getElementById('{{p.id}}');
            var likes = {{p.likes.count}};
            var liked = {% if p.liked %} true; likes -= 1; {% else %} false; {% endif %}
            var likesEl = document.getElementById('{{p.id}}s');

            like.onclick = function(){
                if ({{user.id}}) {

                    liked = !liked;
                    if (liked) {
                        like.src = '/static/liked.png';
                        likesEl.innerHTML = likes + 1;
                    } else {
                        like.src = '/static/like.png';
                        likesEl.innerHTML = likes;
                    }

                    var button = $(this)
                    $.ajax(button.data('url'), {
                        'type': 'POST',
                        'async': true,
                        'dataType': 'json',
                        'data': {
                            'csrfmiddlewaretoken': $('input[name="csrfmiddlewaretoken"]').val(),
                            'typeSend': 'like',
                            'post': {{p.id}}
                        },
                        'success': function(data){

                        }
                    })
                }
            };
        </script>
    </post>

    {% if post.user.id == user.id %}
        <post id="postEdit" style="position: absolute; visibility: hidden">
            {{ form1 }}
            <input type="submit" id="btnEdit">
        </post>

        <input type="submit" id="changer" value="Change" style="changer">
        <script>
            var post = document.getElementById('post');
            var postEdit = document.getElementById('postEdit');

            document.getElementById('changer').onclick = function(){
                if (post.style.visibility === "hidden") {
                    postEdit.style = "visibility: hidden;";
                    post.style = "visibility: visible;";
                    postEdit.replaceWith(post);
            } else {
                    post.style = "visibility: hidden;";
                    postEdit.style = "visibility: visible;";
                    post.replaceWith(postEdit);
                }
            };
        </script>
    {% endif %}
    <divider>Comments</divider>

    {% if user %}
        {{ form }}
        <input type="submit" id="btnCom">
        <info id="comAnswer"></info>
    <script src="/static/js/post.js"></script>
    {% endif %}

    {% for c in comments %}
        <info>{{c.text}}</info>
    {% endfor %}

</centerSide>

{% endblock %}